<!DOCTYPE html>
<html>
<head>
    <title>Data Analysis and Visualization</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <!-- Bootstrap Multiselect CSS -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.16/css/bootstrap-multiselect.css">

    <!-- Bootstrap Multiselect JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.16/js/bootstrap-multiselect.js"></script>

    <style>
        /* Add your CSS styles here */



    </style>
</head>
<body>
{% include 'NavBar/navbar.html' %}
<div class="container mt-5">
    <h2 class="text-center">Data Analysis and Visualization</h2>
    <div class="row">
        <!-- Left section: Display feature selection and reconstruct signal -->
        <div class="col-md-2">
            <a href="{% url 'signal_visualization_view' file_id %}" class="btn btn-primary mt-3">Reconstruct Signal</a>

            <div>
                <!-- Start with Modal button-->
                <a data-target="#myModal" data-toggle="modal" class="btn btn-primary mt-3" id="MainNavHelp"
                   href="#myModal">Signal Customization</a>
            </div>
        </div>

        <!-- Start Modal -->
        <div id="myModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Feature Selection Panel</h4>
                    </div>
                    <div class="modal-body">
                        <div class="container mt-4">
                            <div class="custom-dropdown">
                                <button class="dropdown-toggle" data-bs-toggle="dropdown">Channel Selection</button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item">
                                        <input type="checkbox" id="optionAllChannels">
                                        <label for="optionAllChannels">Select all channels</label>
                                    </div>
                                    <!-- Dynamically generate channel selection options based on num_columns -->
                                    <script>
                                for (var i = 1; i <= {{ num_columns }}; i++) {
                                    document.write('<div class="dropdown-item">' +
                                        '<input type="checkbox" id="channel' + i + '" class="channel-checkbox">' +
                                        '<label for="channel' + i + '">Channel' + i + '</label>' +
                                        '</div>');
                                }

                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button class="btn btn-primary" id="apply-channel-selection">Apply Channel Selection</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Modal -->

        <!-- Middle section: Display data table (60% width) -->
        <div class="col-md-8">
            <h4 class="text-center">File Content</h4>
            <div class="table-container">
                <table class="table table-striped table-bordered table-hover data-table">
                    <thead>
                    {% for column in column_names %}
                    <th>{{ column }}</th>
                    {% endfor %}
                    </thead>
                    <tbody>
                    {% for row in file_content %}
                    <tr>
                        {% for cell in row %}
                        <td>{{ cell }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if validation_errors %}
            <div class="alert alert-danger">
                <strong>Validation Errors:</strong>
                <ul>
                    {% for error in validation_errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>

        <!-- Right section: Generate Pandas Profiling Report (40% width) -->
        <div class="col-md-2">
            <form method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary btn-block" name="generate_report">Generate Profiling
                    Report
                </button>
            </form>
            {% if profile_html %}
            {{ profile_html|safe }}
            {% else %}
            <p>No data available for profiling.</p>
            {% endif %}
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('#ingredients').multiselect();
    });

    $(document).ready(function() {
        $('#mySelect').multiselect({
            buttonWidth: '100%',  // Set the width of the dropdown button
            enableFiltering: true, // Enable search/filtering of options
            includeSelectAllOption: true, // Add "Select All" option
        });
    });

    // JavaScript for handling the "Select all channels" checkbox
    $('#optionAllChannels').change(function() {
        let checked = $(this).prop('checked');
        $('input[type="checkbox"]').prop('checked', checked);
    });

    // JavaScript for applying channel selection
    $('#apply-channel-selection').click(function() {
        // Collect the selected channels and perform further actions (e.g., visualization)
        const selectedChannels = [];
        $('input[type="checkbox"]:checked').each(function() {
            if (this.id !== "optionAllChannels") {
                selectedChannels.push(this.id);
            }
        });

        // Redirect or perform visualization based on selected channels
        if (selectedChannels.length > 0) {
            // Construct the URL to visualize the selected channels
            let url = "{% url 'visualize_channels' file_id %}?channels=";
            url += selectedChannels.join(',');
            window.location.href = url;
        } else {
            // No channels selected, show an alert or take appropriate action
            alert("Please select at least one channel.");
        }
    });




</script>
{% include 'headerFooter/footer.html' %}
</body>
</html>
